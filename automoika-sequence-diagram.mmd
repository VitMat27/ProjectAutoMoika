sequenceDiagram
    actor Клиент
    participant МобильноеПриложение
    participant WebСервер
    participant ПлатежныйШлюз
    actor Оператор
    actor Мойщик
    participant БазаДанных

    %% Начало сценария - Поиск услуги
    activate Клиент
    Клиент->>+МобильноеПриложение: Открывает карту/выбирает услугу
    МобильноеПриложение->>+WebСервер: Запрос списка моек/слотов
    WebСервер->>+БазаДанных: Получить данные о точках и расписании
    БазаДанных-->>-WebСервер: Данные о мойках и свободных слотах
    WebСервер-->>-МобильноеПриложение: Список доступных моек и времени
    МобильноеПриложение-->>-Клиент: Отображение выбора

    %% Процесс бронирования и оплаты
    Клиент->>+МобильноеПриложение: Выбирает мойку, время, услугу
    МобильноеПриложение->>+WebСервер: Запрос на бронирование слота
    Note over WebСервер: Система временно блокирует слот
    WebСервер-->>-МобильноеПриложение: Подтверждение возможности брони
    МобильноеПриложение->>Клиент: Запрос на оплату
    Клиент->>МобильноеПриложение: Подтверждает оплату
    МобильноеПриложение->>+WebСервер: Инициировать платеж (данные карты/Apple Pay)
    WebСервер->>+ПлатежныйШлюз: Запрос на списание средств
    ПлатежныйШлюз-->>-WebСервер: Подтверждение успешной оплаты
    WebСервер->>+БазаДанных: Фиксирует бронь со статусом "Оплачено"
    БазаДанных-->>-WebСервер: OK
    WebСервер-->>-МобильноеПриложение: Подтверждение брони и чек

    %% Уведомления после брони
    WebСервер->>Оператор: Push/Web уведомление: "Новая запись"
    WebСервер->>Мойщик: Обновление списка заказов на табло

    %% Клиент приезжает на мойку
    Клиент->>Мойщик: Прибытие на мойку, предъявление чека
    Мойщик->>+WebСервер: Отмечает "Начать услугу" (с планшета)
    WebСервер->>+БазаДанных: Обновить статус заказа на "В процессе"
    БазаДанных-->>-WebСервер: OK
    WebСервер-->>-Мойщик: Подтверждение
    WebСервер->>Клиент: Push: "Ваш автомобиль начали мыть"

    %% Завершение услуги
    Мойщик->>+WebСервер: Отмечает "Услуга завершена"
    WebСервер->>+БазаДанных: Обновить статус заказа на "Выполнено"
    БазаДанных-->>-WebСервер: OK
    WebСервер-->>-Мойщик: Подтверждение
    WebСервер->>Клиент: Push: "Автомобиль готов! Оставьте отзыв"

    %% Обратная связь
    Клиент->>+МобильноеПриложение: Оставляет отзыв и оценку
    МобильноеПриложение->>+WebСервер: Отправить отзыв и оценку
    WebСервер->>+БазаДанных: Сохранить отзыв и обновить рейтинг
    БазаДанных-->>-WebСервер: OK
    WebСервер-->>-МобильноеПриложение: Благодарность за отзыв
    deactivate Клиент
